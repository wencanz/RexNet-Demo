<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Relatable Explanations</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">
        <header>
          <h1>Relatable Explanations</h1>
          <h2>for speech emotion recognition</h2>
          <!-- </br> -->
        </header>

        <section id="instruction_content">
          <span style="font-size:19px; line-height:200%;"><em>Welcome to Relatable Explanations Demo! You can specify the <span style="color:#5288eb">speech sample</span>, view <span style="color:#5288eb">the system prediction</span> and corresponding <span style="color:#5288eb">explanations</span>.
          </em></span>
        </section>
        </br>
        </br>  
        <section id="main_content">
        	<span style="font-size:19px; line-height:200%;">Play this voice clip 
            <select id="changeInstance" style=""><option value="1">Sample 1</option><option value="2">Sample 2</option><option value="3">Sample 3</option></select>
            <audio preload="auto" id="targetSample" controls="true" class="qmedia"><source type="audio/wav" src="instance1/Target.wav"></audio>. </br></span>

        	<span style="font-size:19px; line-height:200%;">The system recognized the voice as <u><span id="label">Disgust</span></u>. </br></span>

        	<span style="font-size:19px; line-height:200%;">The system has analyzed that, compared with 
        		<select id="changeEmot" style=""><option value="1">Neutral</option><option value="2">Calm</option><option value="3">Happy</option><option value="4">Fearful</option><option value="5">Surprised</option><option value="6">Sad</option><option value="7">Disgust</option><option value="8">Angry</option> </select>
        		<audio preload="auto" id="compareSample" controls="true" class="qmedia"><source type="audio/wav" src="instance1/2Neutral.wav"></audio>,</br>
            
        	</span>
        	
        	<ul style="margin-left:30px;">
    			 	<li><span style="font-size:19px;">The voice has: </span>
    					<ul>
    					  	<li id="shrillness"><span style="font-size:19px;"><span style="color:#171379">Higher</span>&nbsp;shrillness</span></li>
    					  	<li id="loudness"><span style="font-size:19px;"><span style="color:#171379">Higher</span>&nbsp;loudness</span></li>
    					  	<li id="pitchmean"><span style="font-size:19px;"><span style="color:#bdc3c7">Similar</span>&nbsp;average pitch</span></li>
    					  	<li id="pitchsd"><span style="font-size:19px;"><span style="color:#bdc3c7">Similar</span>&nbsp;range of pitch</span></li>
    					  	<li id="speed"><span style="font-size:19px;"><span style="color:#e74c3c">Lower</span>&nbsp;speed</span></li>
    					  	<li id="pause"><span style="font-size:19px;"><span style="color:#bdc3c7">Similar</span>&nbsp;pauses</span></li>
    					</ul>
    			 	</li>
    			 	<li><span style="font-size:19px;">During in the highlighted moments below.</span>
    				 	<ul>
    				  		<li><div><span style="font-size:19px;"><img style="width: 400px; height: 55px;" src="instance1/VsNeutral.png" class="saliency" id="saliencyBar"></span></div></li>
    				 	</ul>
    				</li>
    			</ul>
        </section>
         
        <footer>
          This demo page is maintained by <a href="">Wencan</a>, generated by <a href="https://pages.github.com">GitHub Pages</a>. 
          <!-- Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>. -->
        </footer>
        <script type="text/javascript">
          var figure = $('#saliencyBar')[0];
          var targetWav = $('#targetSample')[0];
          var compareWav = $('#compareSample')[0];
          var emotList = ['Neutral', 'Calm', 'Happy', 'Fearful', 'Surprised', 'Sad', 'Disgust', 'Angry']; 
          var colorMap = {'Lower':'#e74c3c', 'Fewer':'#e74c3c', 'Similar':'#bdc3c7', 'More': '#171379', 'Higher': '#171379'};
          var targetSamples = ['Disgust', 'Happy', 'Angry'];
          var colorPrefix = '<span style="font-size:19px;"><span style="color:';
          var targetIdx = "1";
          var targetSample = targetSamples[0];
          var compareSample = "Neutral";

          $('#changeEmot').change(function() {
            compareSample = emotList[this.value-1];
            figure.src = "instance"+targetIdx+"/Vs"+compareSample+".png";
            compareWav.src = "instance"+targetIdx+"/2"+compareSample+".wav";
            compareWav.play();
            
            var cueTable = d3.csv("query_table.csv",              
              function(row) {
                if (targetIdx == row.Index && compareSample == row.ToCompare){
                  document.getElementById("shrillness").innerHTML = colorPrefix+colorMap[row.Shrillness]+';">'+row.Shrillness+'</span> shrillness</span>';
                  document.getElementById("loudness").innerHTML = colorPrefix+colorMap[row.Loudness]+';">'+row.Loudness+'</span> loudness</span>';
                  document.getElementById("pitchmean").innerHTML = colorPrefix+colorMap[row.PitchMean]+';">'+row.PitchMean+'</span> average pitch</span>';
                  document.getElementById("pitchsd").innerHTML = colorPrefix+colorMap[row.PitchSD]+';">'+row.PitchSD+'</span> range of pitch</span>';
                  document.getElementById("speed").innerHTML = colorPrefix+colorMap[row.Speed]+';">'+row.Speed+'</span> speed</span>';
                  document.getElementById("pause").innerHTML = colorPrefix+colorMap[row.Pause]+';">'+row.Pause+'</span> pauses</span>';
                }
              },
              function(data){}
            );
          });

          $('#changeInstance').change(function() {
            targetIdx = this.value;
            compareSample = "Neutral";
            targetSample = targetSamples[this.value-1];
            document.getElementById("label").innerHTML = targetSample;
            figure.src = "instance"+targetIdx+"/Vs"+compareSample+".png";
            targetWav.src = "instance"+targetIdx+"/Target.wav";
            compareWav.src = "instance"+targetIdx+"/2"+compareSample+".wav";
            $('#changeEmot').val('1');
            
            var cueTable = d3.csv("query_table.csv",
              function(row) {
                if (targetIdx == row.Index && targetSample == row.Target && compareSample == row.ToCompare){
                  document.getElementById("shrillness").innerHTML = colorPrefix+colorMap[row.Shrillness]+';">'+row.Shrillness+'</span> shrillness</span>'
                  document.getElementById("loudness").innerHTML = colorPrefix+colorMap[row.Loudness]+';">'+row.Loudness+'</span> loudness</span>'
                  document.getElementById("pitchmean").innerHTML = colorPrefix+colorMap[row.PitchMean]+';">'+row.PitchMean+'</span> average pitch</span>'
                  document.getElementById("pitchsd").innerHTML = colorPrefix+colorMap[row.PitchSD]+';">'+row.PitchSD+'</span> range of pitch</span>'
                  document.getElementById("speed").innerHTML = colorPrefix+colorMap[row.Speed]+';">'+row.Speed+'</span> speed</span>'
                  document.getElementById("pause").innerHTML = colorPrefix+colorMap[row.Pause]+';">'+row.Pause+'</span> pauses</span>'
                }
              },
              function(data){}
            );
          });
        </script>
      </div>
    </div>
  </body>
</html>
